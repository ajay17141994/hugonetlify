<!DOCTYPE html>
<html>
    {{ partial "head" .}}
<body>
<!-- OUTER CONTAINER -->
<div class="outerContainer">
    <div id="localities" style="display: none;">{{ .Params.sub_locality}}</div>
    <div id="postType" style="display: none;">{{ .Params.postType}}</div>
    <div id="current_city" style="display: none;">{{ .Params.Title }}</div>
    <!-- {{ partial "navigation" .}} -->
    {{ partial "header" .}}
    <div class="mainContainer">
        <!-- RIGHT PART/SECTION OF THE PAGE STARTS HERE -->
        <div class= 'rightPart'>
            {{ partial "pageHeading_section" .}}
            {{ partial "staticdata" .}}
            <div class="subWrapper">
                <div class="para_section">
                    <p class="data">{{.Params.sub_footerData}}</p>
                </div>
            </div> 
            <div class="subWrapper">
                {{ partial "getintouch_section" .}}
            </div> 
        </div>
        <!-- LEFT PART/SECTION OF THE PAGE STARTS HERE -->
        <div class= 'left'>
            <div class="leftWrapper">
                <div class="top_section">
                    <p class="percentage">0.89%</p>
                    <p class="interateRate">Per month interest rate*</p>
                </div>
                <div class="mid_section">
                    <p class="paraone">gold loans made</p>
                    <p class="paratwo">fair fast and flexible</p>
                    <div class="led_imagewrapper">
                        <div class="back_circle"></div>
                        <!-- <img class="permonth_interestimgae" src="../../images/uploads/image-14@3x@2x.png" alt="permonth_interest"/> -->
                    </div>
                </div>
                <!-- APPLY NOW WITH MOBILE NUMBER SECTION GOES HERE -->
                <div class="bottom_section" id="mobile_numberInput">
                    <div class="input_wrapper">
                      <input class="mobile_no" type="number" id="mobile_number" onfocus="document.getElementById('mobile_errormessage').style.display='none'"  name="mobile_number" placeholder="Enter Your Mobile Number" minlength="10" maxlength="10" oninput="value = value.replace(/[^0-9]/g, '').replace(/(\.*)\./g, '$1');" required
                      />
                      <span class="mobile_errormessage" id="mobile_errormessage">Please enter valid Mobile Number</span>
                      <button class="action_button" id="capture_mobileNumber" onclick="capture_mobileNumber()" >Proceed</button>
                    </div>
                </div>
                <div class="bottom_section" id="pincode_Input">
                  <div class="input_wrapper">
                    <input class="pincode" type="number" id="pincode" name="pincode" onfocus="document.getElementById('pincode_errormessage').style.display='none'" placeholder="Enter pincode" name="pincode" pattern="[0-9]{6}" maxlength="6" oninput="value = value.replace(/[^0-9]/g, '').replace(/(\.*)\./g, '$1');"
                    />
                    <span class="pincode_errormessage" id="pincode_errormessage">Please enter valid Pincode</span>
                    <button class="action_button" onclick="updateGoogleSheet()">Apply Now</button>
                  </div>
                </div>
            </div>
        </div>
    </div>
    <!-- FOOTER GOES HERE -->
    {{ partial "footer" .}}
    {{ partial "menumodal_mobile" .}}
</div>



    <script>
        // GETTING LOCALITY LIST ON PAGE LOAD (IIFE FUNCTION)
        (function fetchLocality(){
            let sublocalities=document.getElementById("localities").innerText.split(/[,\-_]/)
            console.log("sublocalities", sublocalities);
            let postType=document.getElementById("postType").innerText
            for (i=0;i<sublocalities.length;i++)
            {
                let localityData=sublocalities[i].trim();
                localityData=localityData.replace(/ /g, "-")
                document.getElementById("localityname_desktop").innerHTML += "<a class='locality_name' href=/"+postType+"/"+localityData+"><div>"+sublocalities[i]+"</div></a>"
            }
        })()


        // NAVIGATION CONTROL FIUNCTION FOR HAMBERG CLICK
        function navigationControl() {
        let topNav_divData = document.getElementById("myTopnav");
        if (topNav_divData.className === "topnav") {
            topNav_divData.className += " responsive";
        } else {
            topNav_divData.className = "topnav";
        }
        }


        // GETTING LOCALITY ON CLICK OF THE OPTIONS THAT HAS BEEN SELECTED BY THE USER
        function gettingLocality(e){
        document.getElementById("selectedValue").value=e.target.innerText;
        document.getElementById("selectedValue").innerHTML=e.target.innerText;
        document.getElementById("localities_select").style.display="none";
        }

        
        // TOGGLE CUSTIOM MADE DROPDOWN FOR LOCALITY IN THE MOBILE
        function toggleSelectoptions(id) {
            let div = document.getElementById("localities_select");
            let sublocalities=document.getElementById("localities").innerText.split(/[,\-_]/)
            
            for (i=0;i<sublocalities.length;i++)
            {
                let localityData=sublocalities[i].trim();
                localityData=localityData.replace(/ /g, "-")
                document.getElementById("localities_select").innerHTML += "<li class='customselect_li localities_option'><a class='locality_name' href=/"+postType+"/"+localityData+">"+sublocalities[i]+"</a></li>"
            };
            div.style.display = div.style.display == "block" ? "none" : "block";
        }

       
    </script>
    <script>
        var monthList = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
        var utmSource = '-',
              utmMedium = '-',
              utmCampaign = '-',
              gclId = '-',
              uniqueNumber, mobileNumber, width, userName = '-',
              goldAmt = '',
              pinCode = '-',
              selected_value = '-',
              existingLoan = '-',
              otpNum = '-',
              otpVerified = false;
              var currentUrl=window.location.href;
          function phoneValidation(phoneNumber) {
              let regEx = /^([6-9])([0-9]{9})$/g;
              return phoneNumber.match(regEx) ? true : false;
          }
          function pincodeValidation(pincode){
            console.log("pincode", pincode)
            let testingpara=/^[0-9]{1,6}$/;
            return pincode.match(testingpara) ? true : false;
          }
        function capture_mobileNumber() {
              console.log("MOBILE COUNT FUNCTION HAS BEEN CALLED");
              var phone = document.getElementById("mobile_number").value;
              console.log("phone", phone);
              console.log("phoneValidation", phoneValidation(phone));
              if(phoneValidation(phone)){
                mobileNumber = document.getElementById("mobile_number").value;
                pushMobileGoogleSheet(this, mobileNumber);
                document.getElementById("mobile_numberInput").style.display="none"
                document.getElementById("pincode_Input").style.display="block"
              }
              else{
                document.getElementById("mobile_errormessage").style.display="block"
              }
          }
      function fetchingBasic_data(){
          let currentDate = new Date();
              // variable is used to store current date
              let date = currentDate.getDate();
              // variable is used to store current month
              let month = currentDate.getMonth();
              // variable is used to store current year
              let year = currentDate.getFullYear();
              // variable is used to store hour
              let hour = parseInt(currentDate.getHours());
              // variable is used to store current minutes
              let minutes = currentDate.getMinutes();
              // if time is below 12 hours then adding "AM" else adding "PM" and converted to 12 hour format
              let time = (hour < 12) ? hour + ':' + minutes + ' AM' : ((hour === 12) ? hour : (hour % 12)) + ':' + minutes + ' PM';
              // variable is used to store current date and time in DD-MM-YYYY Time Format
              let timeStamp = `${date}-${monthList[month]}-${year} ${time}`;
              
              return {date, month, year, hour, minutes, time, timeStamp}
      }
      function pushMobileGoogleSheet(target) {
              console.log("PUSH MOBILE GOOOGLE SHEET HAS BEEN CALLED");
              let schemes = {}
              let url = 'https://vs.rupeek.com:446/gsheets';
              // if ($(target).data('api') === 'third-party') {
              //     storeWebFlowSession(uniqueNumber);
              //     url = 'https://vs.rupeek.com:446/gsheets/thirdPartyLeadCreate';
              // }
              let requiredData=fetchingBasic_data();
              // variable is used to store current date and time in DD-MM-YYYY Time Format
              let timeStamp = requiredData.timeStamp;
              schemes.timestamp = timeStamp;
              schemes.sessionId = uniqueNumber;
              schemes.productListing_phone = mobileNumber;
              schemes.productlistingUrl = currentUrl;
      
              console.log("pushMobileGoogleSheet", schemes);
              // ajax api call
              let xhr = new XMLHttpRequest();
              xhr.open('POST', url)
              xhr.send(schemes)
              xhr.onload = function() {
                console.log(`Loaded: ${xhr.status} ${xhr.response}`);
              };
              xhr.onerror = function() { // only triggers if the request couldn't be made at all
                alert(`Network Error`);
              };
          }
      
      
      
      // function for updating data on last submit.
          function updateGoogleSheet(target) {
              console.log("updateGoogleSheet CALLED");
              let url = 'https://vs.rupeek.com:446/gsheets/update';
      
              // if ($(target).data('api') === 'third-party') {
              //     storeWebFlowSession(uniqueNumber)
              //     url = 'https://vs.rupeek.com:446/gsheets/thirdPartyLeadUpdate';
              // }
              let requiredData=fetchingBasic_data();
              // variable is used to store current date and time in DD-MM-YYYY Time Format
              let timeStamp = requiredData.timeStamp;
              let current_city=document.getElementById("current_city").innerText;
              let pin_code=document.getElementById("pincode").value;
              let pin_codeVerification=pincodeValidation(pin_code);
              console.log("pin_codeVerification",pin_codeVerification);
              // if name and mobile number enter user then click data push to api else throw error message
              if (mobileNumber && mobileNumber.length === 10 && current_city && pin_codeVerification) {
                  // Object is used to store the sessionId,phone number,name,city,gclid,timestamp,utmsource,utmmedium,utmcampaign,user name and gold amount
                  let schemes = {}
                  schemes.sessionId = uniqueNumber;
                  schemes.productListing_phone = mobileNumber;
                  schemes.name = userName;
                  schemes.timestamp = timeStamp;
                  schemes.gclid = gclId;
                  schemes.city = current_city;
                  schemes.utmSource = utmSource;
                  schemes.utmMedium = utmMedium;
                  schemes.utmCampaign = utmCampaign;
                  schemes.productListingUrl = currentUrl;
                  schemes.dm_gold_amount = goldAmt;
                  schemes.pin_code = pin_code;
                  schemes.existing_loan = existingLoan;
                  schemes.otp_verified_user = otpVerified;
      
                  console.log("updateGoogleSheet schemes", schemes);
                  // ajax api call
                  let xhr = new XMLHttpRequest();
                  xhr.open('POST', url)
                  xhr.send(schemes)
                  xhr.onload = function() {
                    alert(`Loaded: ${xhr.status} ${xhr.response}`);
                    document.getElementById("mobile_numberInput").style.display="block"
                    document.getElementById("pincode_Input").style.display="none"
                  };
      
                  xhr.onerror = function() { // only triggers if the request couldn't be made at all
                    alert(`Network Error`);
                  };
              } else {
                  console.log('error');
                  document.getElementById("pincode_errormessage").style.display="block"
              }
          }
      
      
      
      
      </script>
</body>
</html>